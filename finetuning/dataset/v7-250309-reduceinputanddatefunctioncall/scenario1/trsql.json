[
  {
    "Input": "어제 우리반과 옆반의 설정온도 차이 알려줘",
    "Tags": {
      "SQL_Q": "SELECT \"settemp\",\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM data_t\nWHERE idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7'))\n  AND \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '1 day')\n  AND \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE)\n  AND \"settemp\" IS NOT NULL\n  AND \"settemp\" IS DISTINCT FROM 'NaN' ORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT settemp,\n         (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name\n  FROM data_t\n  WHERE idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7'))\n    AND \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '1 day')\n    AND \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE)\n    AND \"settemp\" IS NOT NULL\n    AND \"settemp\" IS DISTINCT FROM 'NaN'\n ORDER BY timestamp), t AS (\n  SELECT AVG(CASE WHEN idu_name = '01_IB5' THEN settemp END) AS settemp_ours,\n         AVG(CASE WHEN idu_name = '01_IB7' THEN settemp END) AS settemp_beside\n  FROM qr\n)\nSELECT settemp_ours,\n       settemp_beside,\n       settemp_ours - settemp_beside AS settemp_diff\nFROM t;",
      "final_result": "result"
    }
  },
  {
    "Input": "오늘 우리반과 옆반의 평균 온도차이 알려줘",
    "Tags": {
      "SQL_Q": "SELECT \"roomtemp\",\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM data_t\nWHERE idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7'))\n  AND \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE)\n  AND \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n  AND \"roomtemp\" IS NOT NULL\n  AND \"roomtemp\" IS DISTINCT FROM 'NaN' ORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp,\n         (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name\n  FROM data_t\n  WHERE idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7'))\n    AND \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE)\n    AND \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n    AND \"roomtemp\" IS NOT NULL\n    AND \"roomtemp\" IS DISTINCT FROM 'NaN'\n ORDER BY timestamp), t AS (\n  SELECT AVG(CASE WHEN idu_name = '01_IB5' THEN roomtemp END) AS roomtemp_ours,\n         AVG(CASE WHEN idu_name = '01_IB7' THEN roomtemp END) AS roomtemp_beside\n  FROM qr\n)\nSELECT roomtemp_ours,\n       roomtemp_beside,\n       roomtemp_ours - roomtemp_beside AS roomtemp_diff\nFROM t;",
      "final_result": "result"
    }
  },
  {
    "Input": "작년 겨울 우리반 평균온도 알려줘",
    "Tags": {
      "SQL_Q": "SELECT \"roomtemp\",\n       \"timestamp\"\nFROM data_t\nWHERE idu_id = (SELECT id FROM idu_t WHERE name='01_IB5')\n  AND \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE) - INTERVAL '9 month'\n  AND \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE) - INTERVAL '6 month'\n  AND \"roomtemp\" IS NOT NULL\n  AND \"roomtemp\" IS DISTINCT FROM 'NaN' ORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp\n  FROM data_t\n  WHERE idu_id = (SELECT id FROM idu_t WHERE name='01_IB5')\n    AND \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE) - INTERVAL '9 month'\n    AND \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE) - INTERVAL '6 month'\n    AND \"roomtemp\" IS NOT NULL\n  AND \"roomtemp\" IS DISTINCT FROM 'NaN'\n ORDER BY timestamp)\nSELECT AVG(roomtemp) AS roomtemp_avg\nFROM qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "올해 여름 앞반 평균온도 알려줘",
    "Tags": {
      "SQL_Q": "SELECT \"roomtemp\",\n       \"timestamp\"\nFROM data_t\nWHERE idu_id = (SELECT id FROM idu_t WHERE name='02_I81')\n  AND \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '5 month'\n  AND \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '8 month'\n  AND \"roomtemp\" IS NOT NULL\n  AND \"roomtemp\" IS DISTINCT FROM 'NaN' ORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp\n  FROM data_t\n  WHERE idu_id = (SELECT id FROM idu_t WHERE name='02_I81')\n    AND \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '5 month'\n    AND \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '8 month'\n    AND \"roomtemp\" IS NOT NULL\n    AND \"roomtemp\" IS DISTINCT FROM 'NaN' ORDER BY timestamp)\nSELECT AVG(roomtemp) AS roomtemp_avg\nFROM qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "올해 봄 옆반 제일 추웠던 날 알려줘",
    "Tags": {
      "SQL_Q": "SELECT \"roomtemp\",\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM data_t\nWHERE idu_id = (SELECT id FROM idu_t WHERE name='01_IB7')\n  AND \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '2 month'\n  AND \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '5 month'\n  AND \"roomtemp\" IS NOT NULL\n  AND \"roomtemp\" IS DISTINCT FROM 'NaN' ORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp, \"timestamp\"\n  FROM data_t\n  WHERE idu_id = (SELECT id FROM idu_t WHERE name='01_IB7')\n    AND \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '2 month'\n    AND \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '5 month'\n    AND \"roomtemp\" IS NOT NULL\n    AND \"roomtemp\" IS DISTINCT FROM 'NaN' ORDER BY timestamp),\n t AS (SELECT MIN(roomtemp) AS coldest_temp FROM qr)\nSELECT ARRAY(SELECT TO_CHAR(\"timestamp\", 'YYYY-MM-DD') FROM qr, t WHERE qr.roomtemp = t.coldest_temp) AS coldest_dates,\n       coldest_temp\nFROM t;",
      "final_result": "result"
    }
  },
  {
    "Input": "4월 앞반 평균온도 알려줘",
    "Tags": {
      "SQL_Q": "SELECT \"roomtemp\",\n       \"timestamp\"\nFROM data_t\nWHERE idu_id = (SELECT id FROM idu_t WHERE name='02_I81')\n  AND \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '3 month'\n  AND \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '4 month'\n  AND \"roomtemp\" IS NOT NULL\n  AND \"roomtemp\" IS DISTINCT FROM 'NaN' ORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp\n  FROM data_t\n  WHERE idu_id = (SELECT id FROM idu_t WHERE name='02_I81')\n    AND \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '3 month'\n    AND \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '4 month'\n    AND \"roomtemp\" IS NOT NULL\n    AND \"roomtemp\" IS DISTINCT FROM 'NaN' ORDER BY timestamp)\nSELECT AVG(roomtemp) AS roomtemp_avg\nFROM qr;",
      "final_result": "result"
    }
  },
{
  "Input": "이번달 중 우리반 온도가 가장 덜 더운날이 언제야?",
  "Tags": {
    "SQL_Q": "SELECT roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('month', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('month', CURRENT_DATE) + INTERVAL '1 month'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "/* ① 월-전체 → qr\n   ② 최저 온도 minv\n   ③ 그 온도와 같은 행 중 날짜만 추려 unique_dates */\nWITH qr AS (SELECT roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('month', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('month', CURRENT_DATE) + INTERVAL '1 month'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\"),\n     minv AS (\n       SELECT MIN(roomtemp) AS coldest_temp FROM qr\n     ),\n     unique_dates AS (\n       SELECT DISTINCT DATE(\"timestamp\") AS d\n       FROM   qr, minv\n       WHERE  qr.roomtemp = minv.coldest_temp\n     )\nSELECT ARRAY_AGG(TO_CHAR(d,'YYYY-MM-DD') ORDER BY d) AS coldest_dates,\n       (SELECT coldest_temp FROM minv)              AS coldest_temp\nFROM   unique_dates;"
  }
}



,
{
  "Input": "2주전 우리반과 옆반 합쳐서 설정온도가 가장 낮은날이 언제야?",
  "Tags": {
    "SQL_Q": "SELECT settemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7'))\n  AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE - INTERVAL '2 week')\n  AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week')\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN';",
    "result_name": "qr",
    "SQL_O": "/* ① 주-전체 → qr  -------------------------------------------*/\nWITH qr AS ( /* SQL_Q */ ),\n/* ② 날짜별 평균 설정온도 → daily  -----------------------------*/\n     daily AS (\n       SELECT DATE(\"timestamp\") AS d,\n              AVG(settemp)      AS avg_settemp\n       FROM   qr\n       GROUP  BY d\n     ),\n/* ③ 가장 낮은 평균값 찾기 → mn  ------------------------------*/\n     mn AS (\n       SELECT MIN(avg_settemp) AS coldest_temp\n       FROM   daily\n     )\n/* ④ 그 값과 같은 날짜만 반환 ----------------------------------*/\nSELECT ARRAY_AGG(d ORDER BY d) AS coldest_dates,\n       coldest_temp\nFROM   daily, mn\nWHERE  daily.avg_settemp = mn.coldest_temp;"
  }
}





,

  {
    "Input": "우리반의 가장 최근 설정 온도 알려줘",
    "Tags": {
      "SQL_Q": "SELECT settemp, \"timestamp\"\nFROM data_t\nWHERE idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND \"timestamp\" <= CURRENT_TIMESTAMP\n  AND settemp IS NOT NULL\n  AND settemp IS DISTINCT FROM 'NaN';",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT settemp, \"timestamp\"\n  FROM data_t\n  WHERE idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n    AND \"timestamp\" <= CURRENT_TIMESTAMP\n    AND settemp IS NOT NULL\n    AND settemp IS DISTINCT FROM 'NaN'\n)\nSELECT settemp AS settemp_recent,\n       \"timestamp\" AS settemp_recent_time\nFROM qr\nORDER BY \"timestamp\" DESC\nLIMIT 1;"
    }
  },
  {
    "Input": "옆반의 가장 최근 온도랑 설정온도 알려줘",
    "Tags": {
      "SQL_Q": "SELECT roomtemp, settemp, \"timestamp\"\nFROM data_t\nWHERE idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND \"timestamp\" <= CURRENT_TIMESTAMP\n  AND roomtemp IS NOT NULL\n  AND roomtemp IS DISTINCT FROM 'NaN'\n  AND settemp IS NOT NULL\n  AND settemp IS DISTINCT FROM 'NaN';",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp, settemp, \"timestamp\"\n  FROM data_t\n  WHERE idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n    AND \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n    AND \"timestamp\" <= CURRENT_TIMESTAMP\n    AND roomtemp IS NOT NULL\n    AND roomtemp IS DISTINCT FROM 'NaN'\n    AND settemp IS NOT NULL\n    AND settemp IS DISTINCT FROM 'NaN'\n)\nSELECT roomtemp AS roomtemp_recent,\n       settemp AS settemp_recent,\n       \"timestamp\" AS recent_time\nFROM qr\nORDER BY \"timestamp\" DESC\nLIMIT 1;",
      "final_result": "result"
    }
  }


,
  {
    "Input": "지금 옆반 너무 추워",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       settemp,\n       oper,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '3 hours'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\n  AND  settemp  IS NOT NULL\n  AND  settemp  IS DISTINCT FROM 'NaN'\n  AND  oper     IS NOT NULL\nORDER BY timestamp;",
      "result_name": "qr",
     "SQL_O": "WITH qr AS (\n  SELECT roomtemp,\n         settemp,\n         oper,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n    AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '3 hours'\n    AND  \"timestamp\" <= CURRENT_TIMESTAMP\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n    AND  settemp  IS NOT NULL\n    AND  settemp  IS DISTINCT FROM 'NaN'\n    AND  oper     IS NOT NULL\n)\nSELECT roomtemp,\n       settemp,\n       oper,\n       \"timestamp\"\nFROM   qr\nORDER  BY \"timestamp\";",
      "final_result": "qr"
    }
  },
{
  "Input": "우리반 왜이리 덥노",
  "Tags": {
    "SQL_Q": "SELECT roomtemp,\n       settemp,\n       oper,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '3 hours'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\n  AND  settemp  IS NOT NULL\n  AND  settemp  IS DISTINCT FROM 'NaN'\n  AND  oper     IS NOT NULL\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "WITH qr AS (\n  SELECT roomtemp,\n         settemp,\n         oper,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '3 hours'\n    AND  \"timestamp\" <= CURRENT_TIMESTAMP\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n    AND  settemp  IS NOT NULL\n    AND  settemp  IS DISTINCT FROM 'NaN'\n    AND  oper     IS NOT NULL\n)\nSELECT roomtemp,\n       settemp,\n       oper,\n       \"timestamp\"\nFROM   qr\nORDER  BY \"timestamp\";"
  }
}
,
 {
    "Input": "What is the current temperature in our class?",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n    AND  \"timestamp\" <= CURRENT_TIMESTAMP\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n)\nSELECT roomtemp AS roomtemp_recent\nFROM   qr\nORDER  BY \"timestamp\" DESC\nLIMIT  1;",
      "final_result": "result"
    }
  },
  {
    "Input": "8일전 설정온도는?",
    "Tags": {
      "SQL_Q": "SELECT settemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '8 day')\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE - INTERVAL '7 day')\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT settemp,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '8 day')\n    AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE - INTERVAL '7 day')\n    AND  settemp IS NOT NULL\n    AND  settemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n)\nSELECT AVG(settemp) AS settemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "10년 전 오늘 우리반 온도는?",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '10 year')\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE - INTERVAL '10 year') + INTERVAL '1 day'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '10 year')\n    AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE - INTERVAL '10 year') + INTERVAL '1 day'\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n)\nSELECT AVG(roomtemp) AS roomtemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
  "Input": "에어컨 꺼진 방들 알려줘",
  "Tags": {
    "SQL_Q": "SELECT oper,\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7','02_I81'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  oper IS NOT NULL\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "/* ① 5분 이내 데이터 → qr\n   ② 각 실내기별로 최신 레코드만 추출 → latest\n   ③ 전원이 꺼진 실내기의 idu_id 리스트 → off_ids\n   ④ idu_t 와 조인해 사람 보기 좋은 이름(idu_name)으로 반환 */\nWITH qr AS (\n  SELECT idu_id,\n         oper,\n         \"timestamp\",\n         ROW_NUMBER() OVER (PARTITION BY idu_id ORDER BY \"timestamp\" DESC) AS rn\n  FROM   data_t\n  WHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7','02_I81'))\n    AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n    AND  \"timestamp\" <= CURRENT_TIMESTAMP\n    AND  oper IS NOT NULL\n),\nlatest AS (\n  SELECT idu_id\n  FROM   qr\n  WHERE  rn = 1          -- 각 실내기의 최근 상태\n    AND  oper = FALSE    -- 꺼진 것만\n),\noff_names AS (\n  SELECT name AS idu_name\n  FROM   idu_t\n  WHERE  id IN (SELECT idu_id FROM latest)\n)\nSELECT ARRAY_AGG(idu_name ORDER BY idu_name) AS off_names\nFROM   off_names;",
    "final_result": "result"
  }
}
,
  {
    "Input": "지난주 설정온도가 실내온도보다 더 높았던 날은?",
    "Tags": {
      "SQL_Q": "SELECT settemp,\n       roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week')\n  AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE)\n  AND  settemp  IS NOT NULL\n  AND  settemp  IS DISTINCT FROM 'NaN'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH daily AS (\n  SELECT DATE(\"timestamp\")   AS d,\n         AVG(settemp)  AS avg_settemp,\n         AVG(roomtemp) AS avg_roomtemp\n  FROM   (\n    SELECT settemp,\n           roomtemp,\n           \"timestamp\"\n    FROM   data_t\n    WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n      AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week')\n      AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE)\n      AND  settemp  IS NOT NULL\n      AND  settemp  IS DISTINCT FROM 'NaN'\n      AND  roomtemp IS NOT NULL\n      AND  roomtemp IS DISTINCT FROM 'NaN'\n    ORDER BY timestamp\n  ) t\n  GROUP  BY DATE(\"timestamp\")\n)\nSELECT ARRAY_AGG(d) AS dates\nFROM   daily\nWHERE  avg_settemp > avg_roomtemp;",
      "final_result": "result"
    }
  },
{
  "Input": "우리반 이번달 제일 추웠던 날은 언제냐?",
  "Tags": {
    "SQL_Q": "SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('month', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('month', CURRENT_DATE) + INTERVAL '1 month'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "WITH qr AS (SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('month', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('month', CURRENT_DATE) + INTERVAL '1 month'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\"),\n     minv AS (\n       SELECT MIN(roomtemp) AS coldest_temp FROM qr\n     ),\n     coldest AS (\n       SELECT DISTINCT DATE(\"timestamp\") AS coldest_date\n       FROM   qr, minv\n       WHERE  qr.roomtemp = minv.coldest_temp\n     )\nSELECT ARRAY_AGG(coldest_date ORDER BY coldest_date) AS coldest_dates,\n       (SELECT coldest_temp FROM minv)               AS coldest_temp\nFROM   coldest;",
    "final_result": "result"
  }
}

,
  {
    "Input": "어제 우리반 에어컨 작동 시간 알려줘",
    "Tags": {
      "SQL_Q": "SELECT oper,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '1 day')\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE)\n  AND  oper IS NOT NULL\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH on_events AS (\n  SELECT \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '1 day')\n    AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE)\n    AND  oper = TRUE\n  ORDER BY timestamp\n), periods AS (\n  SELECT LEAD(\"timestamp\") OVER (ORDER BY \"timestamp\") AS next_t,\n         \"timestamp\"                                   AS t\n  FROM   on_events\n)\nSELECT COALESCE(SUM(EXTRACT(EPOCH FROM (next_t - t))),0) / 3600 AS total_time_in_hours\nFROM   periods\nWHERE  next_t IS NOT NULL;",
      "final_result": "result"
    }
  },
  {
    "Input": "우리반, 옆반, 앞반 중 가장 추운 방은?",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7','02_I81'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT idu_name,\n         roomtemp,\n         \"timestamp\",\n         ROW_NUMBER() OVER (PARTITION BY idu_name ORDER BY \"timestamp\" DESC) AS rn\n  FROM   (\n    SELECT (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n           roomtemp,\n           \"timestamp\"\n    FROM   data_t\n    WHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7','02_I81'))\n      AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n      AND  \"timestamp\" <= CURRENT_TIMESTAMP\n      AND  roomtemp IS NOT NULL\n      AND  roomtemp IS DISTINCT FROM 'NaN'\n    ORDER BY timestamp\n  ) sub\n  WHERE  rn = 1\n), t AS (\n  SELECT MIN(roomtemp) AS coldest_temp FROM qr\n)\nSELECT ARRAY(SELECT idu_name FROM qr, t WHERE qr.roomtemp = t.coldest_temp) AS coldest_rooms,\n       coldest_temp\nFROM   t;",
      "final_result": "result"
    }
  },
  {
    "Input": "에어켠 제일 세게 킨 방 3개 알려줘",
    "Tags": {
      "SQL_Q": "SELECT oper,\n       settemp,\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7','02_I81'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  oper    IS NOT NULL\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT idu_name,\n         settemp,\n         oper,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7','02_I81'))\n    AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n    AND  \"timestamp\" <= CURRENT_TIMESTAMP\n    AND  oper    IS NOT NULL\n    AND  settemp IS NOT NULL\n    AND  settemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n), latest AS (\n  SELECT *\n  FROM   qr\n  WHERE  \"timestamp\" = (SELECT MAX(\"timestamp\") FROM qr)\n    AND  oper = TRUE\n), ranked AS (\n  SELECT idu_name,\n         settemp,\n         ROW_NUMBER() OVER (ORDER BY settemp DESC) AS r\n  FROM   latest\n)\nSELECT ARRAY(SELECT idu_name FROM ranked WHERE r <= 3) AS top3_rooms,\n       ARRAY(SELECT settemp  FROM ranked WHERE r <= 3) AS top3_temps;",
      "final_result": "result"
    }
  },
  {
    "Input": "작년 옆반 가장 더웠던 달은?",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE - INTERVAL '1 year')\n  AND  \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE)\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n    AND  \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE - INTERVAL '1 year')\n    AND  \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE)\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n), monthly AS (\n  SELECT TO_CHAR(\"timestamp\", 'YYYY-MM') AS month,\n         AVG(roomtemp)                    AS avg_temp\n  FROM   qr\n  GROUP  BY TO_CHAR(\"timestamp\", 'YYYY-MM')\n), t AS (\n  SELECT MAX(avg_temp) AS hottest_avg FROM monthly\n)\nSELECT ARRAY(SELECT month FROM monthly, t WHERE monthly.avg_temp = t.hottest_avg) AS hottest_months,\n       hottest_avg\nFROM   t;",
      "final_result": "result"
    }
  },
  {
    "Input": "지난달에 설정온도랑 현재온도 차이가 제일 많이 났던 때는 언제야?",
    "Tags": {
      "SQL_Q": "SELECT settemp,\n       roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('month', CURRENT_DATE - INTERVAL '1 month')\n  AND  \"timestamp\" <  DATE_TRUNC('month', CURRENT_DATE)\n  AND  settemp  IS NOT NULL\n  AND  settemp  IS DISTINCT FROM 'NaN'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT settemp,\n         roomtemp,\n         \"timestamp\",\n         roomtemp - settemp AS temp_diff\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('month', CURRENT_DATE - INTERVAL '1 month')\n    AND  \"timestamp\" <  DATE_TRUNC('month', CURRENT_DATE)\n    AND  settemp  IS NOT NULL\n    AND  settemp  IS DISTINCT FROM 'NaN'\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n), t AS (\n  SELECT MAX(temp_diff) AS max_diff FROM qr\n)\nSELECT ARRAY(SELECT TO_CHAR(\"timestamp\", 'YYYY-MM-DD HH24:MI:SS') FROM qr, t WHERE qr.temp_diff = t.max_diff) AS max_diff_timestamps,\n       ARRAY(SELECT settemp  FROM qr, t WHERE qr.temp_diff = t.max_diff) AS max_diff_settemps,\n       ARRAY(SELECT roomtemp FROM qr, t WHERE qr.temp_diff = t.max_diff) AS max_diff_roomtemps,\n       max_diff\nFROM   t;",
      "final_result": "result"
    }
  },
  {
    "Input": "지난 한달간 설정온도 평균을 알려줘.",
    "Tags": {
      "SQL_Q": "SELECT settemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= CURRENT_DATE - INTERVAL '1 month'\n  AND  \"timestamp\" <= CURRENT_DATE\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT settemp,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= CURRENT_DATE - INTERVAL '1 month'\n    AND  \"timestamp\" <= CURRENT_DATE\n    AND  settemp IS NOT NULL\n    AND  settemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n)\nSELECT AVG(settemp) AS settemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "What is the temperature difference between our class and the adjacent class right now?",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT idu_name,\n         roomtemp,\n         \"timestamp\"\n  FROM   (\n    SELECT (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n           roomtemp,\n           \"timestamp\"\n    FROM   data_t\n    WHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7'))\n      AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n      AND  \"timestamp\" <= CURRENT_TIMESTAMP\n      AND  roomtemp IS NOT NULL\n      AND  roomtemp IS DISTINCT FROM 'NaN'\n    ORDER BY timestamp\n  ) sub\n  WHERE  \"timestamp\" = (SELECT MAX(\"timestamp\") FROM data_t WHERE idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7')))\n), t AS (\n  SELECT MAX(CASE WHEN idu_name = '01_IB5' THEN roomtemp END) AS roomtemp_ours,\n         MAX(CASE WHEN idu_name = '01_IB7' THEN roomtemp END) AS roomtemp_theirs\n  FROM   qr\n)\nSELECT roomtemp_ours,\n       roomtemp_theirs,\n       roomtemp_ours - roomtemp_theirs AS temp_diff\nFROM   t;",
      "final_result": "result"
    }
  },
  {
    "Input": "앞반 전원 켜져있어?",
    "Tags": {
      "SQL_Q": "SELECT oper,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '02_I81')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  oper IS NOT NULL\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT oper,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '02_I81')\n    AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n    AND  \"timestamp\" <= CURRENT_TIMESTAMP\n    AND  oper IS NOT NULL\n  ORDER BY timestamp\n)\nSELECT oper\nFROM   qr\nORDER  BY \"timestamp\" DESC\nLIMIT  1;",
      "final_result": "result"
    }
  },
  {
    "Input": "오늘 우리반 에어컨 전원이 처음 켜진 시각 알려줘.",
    "Tags": {
      "SQL_Q": "SELECT oper,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n  AND  oper IS NOT NULL\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT oper,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE)\n    AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n    AND  oper IS NOT NULL\n  ORDER BY timestamp\n)\nSELECT MIN(\"timestamp\") AS first_on\nFROM   qr\nWHERE  oper = TRUE;",
      "final_result": "result"
    }
  },
  {
    "Input": "지난주 우리반은 대체로 몇 도로 설정되어 있었나요?",
    "Tags": {
      "SQL_Q": "SELECT settemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week')\n  AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE)\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT settemp,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week')\n    AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE)\n    AND  settemp IS NOT NULL\n    AND  settemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n), freq AS (\n  SELECT settemp,\n         COUNT(*) AS cnt,\n         RANK() OVER (ORDER BY COUNT(*) DESC) AS r\n  FROM   qr\n  GROUP  BY settemp\n)\nSELECT (SELECT settemp FROM freq WHERE r = 1 LIMIT 1) AS settemp_mode,\n       (SELECT AVG(settemp) FROM qr)              AS settemp_avg;",
      "final_result": "result"
    }
  },
  {
    "Input": "옆반 어제 아침과 저녁의 설정온도 차이는 얼마나 돼?",
    "Tags": {
      "SQL_Q": "SELECT settemp,\n       \"timestamp\",\n       CASE\n         WHEN date_part('hour', \"timestamp\") BETWEEN 6  AND 8  THEN 'morning'\n         WHEN date_part('hour', \"timestamp\") BETWEEN 18 AND 20 THEN 'evening'\n       END AS part\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '1 day')\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE)\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\n  AND  date_part('hour', \"timestamp\") IN (6,7,8,18,19,20)\nORDER BY timestamp;",
      "result_name": "qr_parts",
      "SQL_O": "WITH parts AS (\n  SELECT settemp,\n         part\n  FROM  (\n    SELECT settemp,\n           CASE\n             WHEN date_part('hour', \"timestamp\") BETWEEN 6  AND 8  THEN 'morning'\n             WHEN date_part('hour', \"timestamp\") BETWEEN 18 AND 20 THEN 'evening'\n           END AS part,\n           \"timestamp\"\n    FROM   data_t\n    WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n      AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '1 day')\n      AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE)\n      AND  settemp IS NOT NULL\n      AND  settemp IS DISTINCT FROM 'NaN'\n    ORDER BY timestamp\n  ) sub\n  WHERE part IS NOT NULL\n), agg AS (\n  SELECT AVG(CASE WHEN part = 'morning' THEN settemp END) AS morning_avg,\n         AVG(CASE WHEN part = 'evening' THEN settemp END) AS evening_avg\n  FROM   parts\n)\nSELECT morning_avg,\n       evening_avg,\n       evening_avg - morning_avg AS temp_diff\nFROM   agg;",
      "final_result": "result"
    }
  },
  {
    "Input": "지금 옆반 에어컨 상태 알려줘",
    "Tags": {
      "SQL_Q": "SELECT oper,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  oper IS NOT NULL\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT oper,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n    AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n    AND  \"timestamp\" <= CURRENT_TIMESTAMP\n    AND  oper IS NOT NULL\n  ORDER BY timestamp\n)\nSELECT oper\nFROM   qr\nORDER  BY \"timestamp\" DESC\nLIMIT  1;",
      "final_result": "result"
    }
  },
  {
    "Input": "이번주 우리반 평균 온도 알려줘",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE) + INTERVAL '1 week'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE)\n    AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE) + INTERVAL '1 week'\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n)\nSELECT AVG(roomtemp) AS roomtemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "이번달 우리반 설정온도 최대값과 최소값 알려줘",
    "Tags": {
      "SQL_Q": "SELECT settemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('month', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('month', CURRENT_DATE) + INTERVAL '1 month'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT settemp,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('month', CURRENT_DATE)\n    AND  \"timestamp\" <  DATE_TRUNC('month', CURRENT_DATE) + INTERVAL '1 month'\n    AND  settemp IS NOT NULL\n    AND  settemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n)\nSELECT MAX(settemp) AS settemp_max,\n       MIN(settemp) AS settemp_min\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
  "Input": "우리반과 옆반중 더 추운곳은 어디야?",
  "Tags": {
    "SQL_Q": "SELECT roomtemp,\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "WITH qr AS (SELECT roomtemp,\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\"),\n     ts AS (\n       SELECT MAX(\"timestamp\") AS ts FROM qr\n     ),\n     latest AS (\n       SELECT idu_name,\n              roomtemp\n       FROM   qr JOIN ts ON qr.\"timestamp\" = ts.ts\n     ),\n     pivot AS (\n       SELECT MAX(CASE WHEN idu_name = '01_IB5' THEN roomtemp END) AS roomtemp_ours,\n              MAX(CASE WHEN idu_name = '01_IB7' THEN roomtemp END) AS roomtemp_beside\n       FROM   latest\n     )\nSELECT roomtemp_ours,\n       roomtemp_beside,\n       ABS(roomtemp_ours - roomtemp_beside) AS roomtemp_diff,\n       CASE WHEN roomtemp_ours < roomtemp_beside THEN '01_IB5' ELSE '01_IB7' END AS colder_idu\nFROM   pivot;"
  }
}
,
  {
    "Input": "에어컨 켜져있어?",
    "Tags": {
      "SQL_Q": "SELECT oper,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  oper IS NOT NULL\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT oper,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n    AND  \"timestamp\" <= CURRENT_TIMESTAMP\n    AND  oper IS NOT NULL\n  ORDER BY timestamp\n)\nSELECT oper\nFROM   qr\nORDER  BY \"timestamp\" DESC\nLIMIT  1;",
      "final_result": "result"
    }
  },
  {
    "Input": "How hot was our class over the last month?",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('month', CURRENT_DATE - INTERVAL '1 month')\n  AND  \"timestamp\" <  DATE_TRUNC('month', CURRENT_DATE)\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('month', CURRENT_DATE - INTERVAL '1 month')\n    AND  \"timestamp\" <  DATE_TRUNC('month', CURRENT_DATE)\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n)\nSELECT AVG(roomtemp) AS roomtemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "우리 반 에어컨이 가장 오래 작동했던 날은 언제야?",
    "Tags": {
      "SQL_Q": "SELECT oper,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '7 day')\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n  AND  oper IS NOT NULL\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH base AS (\n  SELECT \"timestamp\",\n         oper,\n         LAG(\"timestamp\") OVER (ORDER BY \"timestamp\") AS prev_ts\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '7 day')\n    AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n    AND  oper IS NOT NULL\n  ORDER BY \"timestamp\"\n), spans AS (\n  SELECT DATE(\"timestamp\") AS d,\n         CASE WHEN oper AND prev_ts IS NOT NULL\n              THEN EXTRACT(EPOCH FROM (\"timestamp\" - prev_ts))\n              ELSE 0 END AS on_secs\n  FROM   base\n), daily AS (\n  SELECT d,\n         SUM(on_secs) AS on_seconds\n  FROM   spans\n  GROUP  BY d\n), t AS (\n  SELECT MAX(on_seconds) AS longest\n  FROM   daily\n)\nSELECT ARRAY(SELECT TO_CHAR(d,'YYYY-MM-DD') FROM daily, t WHERE daily.on_seconds = t.longest) AS longest_oper_dates,\n       (longest / 3600.0)                                             AS longest_oper_time_in_hours\nFROM   t;",
      "final_result": "result"
    }
  },
  {
    "Input": "3주전 우리반 평균 실내온도 알려줘",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '21 day')\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE - INTERVAL '20 day')\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '21 day')\n    AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE - INTERVAL '20 day')\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n)\nSELECT AVG(roomtemp) AS roomtemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "지난달 오늘 오후 2시에 옆반의 설정온도는 어땠어?",
    "Tags": {
      "SQL_Q": "SELECT settemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '1 month') + INTERVAL '14 hours'\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE - INTERVAL '1 month') + INTERVAL '15 hours'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT settemp\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n    AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE - INTERVAL '1 month') + INTERVAL '14 hours'\n    AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE - INTERVAL '1 month') + INTERVAL '15 hours'\n    AND  settemp IS NOT NULL\n    AND  settemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n)\nSELECT AVG(settemp) AS settemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "오늘 오후 4시부터 6시까지 실내온도 평균 알려줘",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '16 hours'\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '18 hours'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '16 hours'\n    AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '18 hours'\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n)\nSELECT AVG(roomtemp) AS roomtemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "지난주 수요일 실내온도 최고값 알려줘",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week') + INTERVAL '2 day'\n  AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week') + INTERVAL '3 day'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (\n  SELECT roomtemp\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week') + INTERVAL '2 day'\n    AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week') + INTERVAL '3 day'\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n  ORDER BY timestamp\n)\nSELECT MAX(roomtemp) AS roomtemp_max\nFROM   qr;",
      "final_result": "result"
    }
  },
{
  "Input": "오늘 오전 11시에 옆반의 실내온도는 어땠어?",
  "Tags": {
    "SQL_Q": "SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '11 hours'\n AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "WITH qr AS (SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '11 hours'\n AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\")\nSELECT AVG(roomtemp) AS roomtemp\nFROM   qr;",
    "final_result": "result"
  }
}
,
 {
  "Input": "오늘 오후 2시에 옆반의 설정온도는 어땠어?",
  "Tags": {
    "SQL_Q": "SELECT settemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '14 hours'\n   AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "WITH qr AS (\n  SELECT settemp,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n    AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '14 hours'\n  AND  settemp IS NOT NULL\n    AND  settemp IS DISTINCT FROM 'NaN'\n  ORDER BY \"timestamp\"\n)\nSELECT AVG(settemp) AS settemp\nFROM   qr;",
    "final_result": "result"
  }
},
{
  "Input": "Why is our classroom so cold",
  "Tags": {
    "SQL_Q": "SELECT roomtemp,\n       settemp,\n       oper,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '3 hours'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\n  AND  oper    IS NOT NULL\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "WITH qr AS (\n  SELECT roomtemp,\n         settemp,\n         oper,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '3 hours'\n    AND  \"timestamp\" <= CURRENT_TIMESTAMP\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n    AND  settemp  IS NOT NULL\n    AND  settemp  IS DISTINCT FROM 'NaN'\n    AND  oper     IS NOT NULL\n  ORDER BY \"timestamp\"\n)\nSELECT roomtemp,\n       settemp,\n       oper,\n       \"timestamp\"\nFROM   qr;",
    "final_result": "result"
  }
}
,
{
  "Input": "오늘 아침과 저녁의 온도차이는 얼마나 돼?",
  "Tags": {
    "SQL_Q": "SELECT roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  (\n       (\"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '6 hours'  AND\n        \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '9 hours')  OR\n       (\"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '18 hours' AND\n        \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '21 hours')\n      )\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "/* ① 하루치 데이터를 qr 로 모은 뒤\n   ② 아침·저녁 평균을 각각 계산\n   ③ 한 행으로 아침·저녁 평균과 차이를 반환 */\nWITH qr AS (/* SQL_Q */),\n     morning AS (\n       SELECT AVG(roomtemp) AS v\n       FROM   qr\n       WHERE  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '6 hours'\n         AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '9 hours'\n     ),\n     evening AS (\n       SELECT AVG(roomtemp) AS v\n       FROM   qr\n       WHERE  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '18 hours'\n         AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '21 hours'\n     )\nSELECT morning.v                AS morning_avg,\n       evening.v                AS evening_avg,\n       evening.v - morning.v    AS temp_diff\nFROM   morning, evening;"
  }
}
,
  {
    "Input": "지금 옆반 온도랑 우리반 온도 알려줘",
    "Tags": {
      "SQL_Q": "SELECT roomtemp,\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS ( SELECT roomtemp,\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('01_IB5','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp),\n     ts AS (SELECT MAX(\"timestamp\") AS ts FROM qr)\nSELECT MAX(CASE WHEN idu_name='01_IB5' THEN roomtemp END) AS roomtemp_ours,\n       MAX(CASE WHEN idu_name='01_IB7' THEN roomtemp END) AS roomtemp_beside\nFROM   qr, ts\nWHERE  qr.\"timestamp\" = ts.ts;",
      "final_result": "result"
    }
  },
  {
    "Input": "현재 설정온도랑 실내온도 차이 알려줘.",
    "Tags": {
      "SQL_Q": "SELECT settemp,\n       roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp;",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (SELECT settemp,\n       roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY timestamp ),\n     last_row AS (\n       SELECT * FROM qr ORDER BY \"timestamp\" DESC LIMIT 1\n     )\nSELECT settemp,\n       roomtemp,\n       roomtemp - settemp AS temp_diff\nFROM   last_row;",
      "final_result": "result"
    }
  },
 {
  "Input": "지난주에 설정온도와 실내온도 차이가 가장 많이 났던 날은?",
  "Tags": {
    "SQL_Q": "SELECT settemp,\n       roomtemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE) - INTERVAL '1 week'\n  AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE)\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "/* ① 주간 전체 → qr ② 날짜별 평균 차이 계산 → agg ③ 최대 차이 추출 → mx */\nWITH qr AS (\n  SELECT settemp,\n         roomtemp,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n    AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE) - INTERVAL '1 week'\n    AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE)\n    AND  settemp IS NOT NULL\n    AND  settemp IS DISTINCT FROM 'NaN'\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n),\nagg AS (\n  SELECT DATE(\"timestamp\")                    AS d,\n         AVG(roomtemp) - AVG(settemp)          AS temp_diff,\n         AVG(settemp)                          AS settemp_avg,\n         AVG(roomtemp)                         AS roomtemp_avg\n  FROM   qr\n  GROUP  BY d\n),\nmx AS (\n  SELECT MAX(temp_diff) AS max_diff\n  FROM   agg\n)\nSELECT ARRAY_AGG(DISTINCT TO_CHAR(d,'YYYY-MM-DD') ORDER BY d) AS max_diff_dates,\n       max_diff,\n       ARRAY_AGG(settemp_avg ORDER BY d)                      AS max_diff_settemps,\n       ARRAY_AGG(roomtemp_avg ORDER BY d)                     AS max_diff_roomtemps\nFROM   agg, mx\nWHERE  agg.temp_diff = mx.max_diff;",
    "final_result": "result"
  }
}
,
 
  {
    "Input": "이번주 설정온도가 실내온도보다 더 낮았던 날은?",
    "Tags": {
      "SQL_Q": "SELECT settemp, roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE) + INTERVAL '1 week'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS ( SELECT settemp, roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE) + INTERVAL '1 week'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\" ),\n     agg AS (\n       SELECT DATE(\"timestamp\") AS d,\n              AVG(settemp)      AS st,\n              AVG(roomtemp)     AS rt\n       FROM   qr\n       GROUP  BY d\n     )\nSELECT ARRAY_AGG(TO_CHAR(d,'YYYY-MM-DD')) AS dates\nFROM   agg\nWHERE  st < rt;",
      "final_result": "result"
    }
  },
  {
    "Input": "어제 전원 껐어?",
    "Tags": {
      "SQL_Q": "SELECT oper, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) - INTERVAL '1 day'\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE)\n  AND  oper IS NOT NULL\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS ( SELECT oper, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) - INTERVAL '1 day'\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE)\n  AND  oper IS NOT NULL\nORDER BY \"timestamp\" )\nSELECT oper\nFROM   qr\nORDER  BY \"timestamp\" DESC\nLIMIT  1;",
      "final_result": "result"
    }
  },
{
  "Input": "최근에 설정온도가 가장 높았던 날 알려줘",
  "Tags": {
    "SQL_Q": "SELECT settemp,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) - INTERVAL '1 week'\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "WITH qr AS ( /* SQL_Q */ ),\n     maxv AS (\n       SELECT MAX(settemp) AS max_settemp FROM qr\n     ),\n     dates AS (\n       SELECT DISTINCT TO_CHAR(\"timestamp\", 'YYYY-MM-DD') AS d\n       FROM   qr, maxv\n       WHERE  qr.settemp = maxv.max_settemp\n     )\nSELECT ARRAY_AGG(d ORDER BY d) AS max_settemp_dates,\n       max_settemp\nFROM   maxv, dates\nGROUP BY max_settemp;",
    "final_result": "result"
  }
}
,
  {
    "Input": "지난 3일 동안 우리반 실내 온도 평균 값 알려줘.",
    "Tags": {
      "SQL_Q": "SELECT roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) - INTERVAL '3 day'\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS ( SELECT roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE) - INTERVAL '3 day'\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\")\nSELECT AVG(roomtemp) AS roomtemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "오늘 오후 5시에 옆반의 설정온도는 어땠어?",
    "Tags": {
      "SQL_Q": "SELECT settemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" = DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '17 hours'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (SELECT settemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" = DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '17 hours'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\" )\nSELECT AVG(settemp) AS settemp\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "올해 여름 우리반 실내온도 최대값과 최소값 알려줘",
    "Tags": {
      "SQL_Q": "SELECT roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '5 month'\n  AND  \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '8 month'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (SELECT roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '5 month'\n  AND  \"timestamp\" <  DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '8 month'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\")\nSELECT MAX(roomtemp) AS roomtemp_max,\n       MIN(roomtemp) AS roomtemp_min\nFROM   qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "지금 우리반 너무 더워",
    "Tags": {
      "SQL_Q": "SELECT roomtemp, settemp, oper, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '3 hours'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\n  AND  oper    IS NOT NULL\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (SELECT roomtemp, settemp, oper, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB5')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '3 hours'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\n  AND  oper    IS NOT NULL\nORDER BY \"timestamp\" )\nSELECT * FROM qr;",
      "final_result": "result"
    }
  },
  {
    "Input": "오늘 4층의 평균 실내온도 알려줘",
    "Tags": {
      "SQL_Q": "SELECT roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (SELECT roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\" )\nSELECT AVG(roomtemp) AS roomtemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  }
,
   {
    "Input": "4층에서 에어컨 꺼진 방들 알려줘",
    "Tags": {
      "SQL_Q": "SELECT oper,\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  oper IS NOT NULL\nORDER BY \"timestamp\";",
      "result_name": "qr",
      
  "SQL_O": "/* ① 방별로 최신 1 행 추출 */\nWITH qr AS (\n  /* SQL_Q */\n),\nlatest AS (\n  SELECT idu_name, oper\n  FROM   (\n    SELECT qr.*,\n           ROW_NUMBER() OVER (PARTITION BY idu_name            -- 방별\n                                ORDER BY \"timestamp\" DESC) AS rn\n    FROM   qr\n  ) t\n  WHERE rn = 1                  -- 각 방의 가장 최근 값\n)\n/* ② 전원 꺼진 방들만 배열로 */\nSELECT array_agg(idu_name ORDER BY idu_name) AS off_names\nFROM   latest\nWHERE  oper = FALSE;",
  "final_result": "result"

    }
  },


{
  "Input": "4층에서 가장 추운 방은 어디야?",
  "Tags": {
    "SQL_Q": "SELECT roomtemp,\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "/* ① 5분 이내 데이터 → qr\n   ② 가장 최신 시각 구해 ts\n   ③ 최신 시각의 측정값만 추려 now1\n   ④ 최저 온도 한 값만 구해 minv\n   ⑤ 그 최저 온도를 갖는 방 이름을 중복 없이 모아 반환 */\nWITH qr AS (SELECT roomtemp,\n       (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n       \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\"),\n     ts   AS (SELECT MAX(\"timestamp\") AS ts FROM qr),\n     now1 AS (\n       SELECT idu_name,\n              roomtemp\n       FROM   qr, ts\n       WHERE  qr.\"timestamp\" = ts.ts\n     ),\n     minv AS (SELECT MIN(roomtemp) AS coldest_temp FROM now1)\nSELECT ARRAY_AGG(DISTINCT idu_name ORDER BY idu_name) AS coldest_rooms,\n       coldest_temp\nFROM   now1, minv\nWHERE  now1.roomtemp = minv.coldest_temp;",
    "final_result": "result"
  }
}
,


  {
    "Input": "4층의 지난달 설정온도 최대값과 최소값 알려줘",
    "Tags": {
      "SQL_Q": "SELECT settemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_DATE - INTERVAL '1 month'\n  AND  \"timestamp\" <  CURRENT_DATE\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (SELECT settemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_DATE - INTERVAL '1 month'\n  AND  \"timestamp\" <  CURRENT_DATE\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\" )\nSELECT MAX(settemp) AS settemp_max,\n       MIN(settemp) AS settemp_min\nFROM   qr;",
      "final_result": "result"
    }
  },

{
  "Input": "오늘 4층에서 가장 더운 방은 어디야?",
  "Tags": {
    "SQL_Q": "SELECT roomtemp, (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name, \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
    "result_name": "qr",
    "SQL_O": "WITH qr AS (\n  SELECT roomtemp,\n         (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name,\n         \"timestamp\"\n  FROM   data_t\n  WHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n    AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE)\n    AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n    AND  roomtemp IS NOT NULL\n    AND  roomtemp IS DISTINCT FROM 'NaN'\n),\nht AS (\n  SELECT MAX(roomtemp) AS hottest_temp FROM qr\n)\nSELECT ARRAY(\n         SELECT DISTINCT idu_name          -- 중복 제거\n         FROM   qr, ht\n         WHERE  qr.roomtemp = ht.hottest_temp\n         ORDER  BY idu_name                -- 보기 좋게 정렬\n       ) AS hottest_rooms,\n       hottest_temp\nFROM   ht;",
    "final_result": "result"
  }
}
,


  {
    "Input": "오늘 4층의 평균 설정온도 알려줘",
    "Tags": {
      "SQL_Q": "SELECT settemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (SELECT settemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= DATE_TRUNC('day', CURRENT_DATE)\n  AND  \"timestamp\" <  DATE_TRUNC('day', CURRENT_DATE) + INTERVAL '1 day'\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\" )\nSELECT AVG(settemp) AS settemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  },

 
  {
    "Input": "에어컨 전원이 켜진 4층 방들 알려줘",
    "Tags": {
      "SQL_Q": "SELECT oper, (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name, \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  oper IS NOT NULL\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS ( SELECT oper, (SELECT name FROM idu_t WHERE id = data_t.idu_id) AS idu_name, \"timestamp\"\nFROM   data_t\nWHERE  idu_id IN (SELECT id FROM idu_t WHERE name IN ('02_I84','02_I85','01_IB7'))\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  oper IS NOT NULL\nORDER BY \"timestamp\"),\n     ts AS ( SELECT MAX(\"timestamp\") AS ts FROM qr ),\n     rooms AS (\n       SELECT idu_name\n       FROM   qr, ts\n       WHERE  qr.\"timestamp\" = ts.ts\n         AND  qr.oper = TRUE\n     )\nSELECT ARRAY(SELECT idu_name FROM rooms) AS on_names;",
      "final_result": "result"
    }
  },

 
  {
    "Input": "오늘 우리반의 가장 최근 설정온도 알려줘",
    "Tags": {
      "SQL_Q": "SELECT settemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '02_I84')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS (SELECT settemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '02_I84')\n  AND  \"timestamp\" >= CURRENT_TIMESTAMP - INTERVAL '5 minutes'\n  AND  \"timestamp\" <= CURRENT_TIMESTAMP\n  AND  settemp IS NOT NULL\n  AND  settemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\" )\nSELECT settemp  AS settemp_recent,\n       \"timestamp\" AS recent_time\nFROM   qr\nORDER  BY \"timestamp\" DESC\nLIMIT  1;",
      "final_result": "result"
    }
  },

  {
    "Input": "저번주 수요일 옆반 실내온도 평균 알려줘",
    "Tags": {
      "SQL_Q": "SELECT roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE) - INTERVAL '1 week' + INTERVAL '2 day'\n  AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE) - INTERVAL '1 week' + INTERVAL '3 day'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\";",
      "result_name": "qr",
      "SQL_O": "WITH qr AS ( SELECT roomtemp, \"timestamp\"\nFROM   data_t\nWHERE  idu_id = (SELECT id FROM idu_t WHERE name = '01_IB7')\n  AND  \"timestamp\" >= DATE_TRUNC('week', CURRENT_DATE) - INTERVAL '1 week' + INTERVAL '2 day'\n  AND  \"timestamp\" <  DATE_TRUNC('week', CURRENT_DATE) - INTERVAL '1 week' + INTERVAL '3 day'\n  AND  roomtemp IS NOT NULL\n  AND  roomtemp IS DISTINCT FROM 'NaN'\nORDER BY \"timestamp\" )\nSELECT AVG(roomtemp) AS roomtemp_avg\nFROM   qr;",
      "final_result": "result"
    }
  }

]
